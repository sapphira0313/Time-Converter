<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¶åŒºè½¬æ¢å™¨ - å·¦å³å¸ƒå±€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            min-height: 500px;
        }

        .left-panel {
            flex: 1;
            padding: 30px;
            background: #f8f9fa;
            border-right: 1px solid #eee;
        }

        .right-panel {
            flex: 1;
            padding: 30px;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }

        .input-group select, .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            background: white;
            transition: border-color 0.3s ease;
        }

        .input-group select:focus, .input-group input:focus {
            border-color: #2196F3;
            outline: none;
        }

        .convert-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 25px auto;
            width: 200px;
        }

        .convert-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .results-title {
            text-align: center;
            font-size: 1.8em;
            margin-bottom: 30px;
            color: #333;
        }

        .result-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #2196F3;
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-3px);
        }

        .result-card.us {
            border-left-color: #FF6B6B;
        }

        .result-card.canada {
            border-left-color: #4ECDC4;
        }

        .result-card.uk {
            border-left-color: #45B7D1;
        }

        .result-card.germany {
            border-left-color: #96CEB4;
        }

        .result-card h3 {
            font-size: 1.4em;
            margin-bottom: 15px;
            color: #333;
        }

        .input-time, .china-time {
            font-size: 1.3em;
            margin: 15px 0;
            padding: 12px;
            border-radius: 5px;
            font-weight: bold;
        }

        .input-time {
            background: #e3f2fd;
            color: #1976d2;
        }

        .china-time {
            background: #fff3e0;
            color: #f57c00;
        }

        .time-difference {
            font-size: 1em;
            color: #666;
            margin-top: 10px;
        }

        .example {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 5px 0;
            color: #666;
            text-align: center;
            font-size: 0.9em;
        }

        .error-message {
            color: #f44336;
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
            font-size: 1.1em;
        }

        .success-message {
            color: #4CAF50;
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
            font-size: 1.1em;
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9em;
            border-top: 1px solid #eee;
            clear: both;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .main-content {
                flex-direction: column;
            }
            
            .left-panel {
                border-right: none;
                border-bottom: 1px solid #eee;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ æ—¶åŒºè½¬æ¢å™¨</h1>
            <p>å·¦å³å¸ƒå±€ - é€‰æ‹©å›½å®¶åè¾“å…¥æ—¶é—´ï¼Œè½¬æ¢ä¸ºä¸­å›½æ—¶é—´</p>
        </div>

        <div class="main-content">
            <div class="left-panel">
                <div class="input-group">
                    <label for="countrySelect">ğŸŒ é€‰æ‹©å›½å®¶</label>
                    <select id="countrySelect">
                        <option value="">-- è¯·é€‰æ‹©å›½å®¶ --</option>
                        <option value="us">ğŸ‡ºğŸ‡¸ ç¾å›½ (å¤ªå¹³æ´‹æ—¶é—´)</option>
                        <option value="canada">ğŸ‡¨ğŸ‡¦ åŠ æ‹¿å¤§ (å¤ªå¹³æ´‹æ—¶é—´)</option>
                        <option value="uk">ğŸ‡¬ğŸ‡§ è‹±å›½ (æ ¼æ—å¨æ²»æ—¶é—´)</option>
                        <option value="germany">ğŸ‡©ğŸ‡ª å¾·å›½ (ä¸­æ¬§æ—¶é—´)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="timeInput">â° è¾“å…¥æ—¶é—´</label>
                    <input type="text" id="timeInput" placeholder="æ ¼å¼: 2024/01/15 14:30:00">
                    <div class="example">ç¤ºä¾‹: 2024/01/15 14:30:00</div>
                </div>

                <button class="convert-btn" onclick="convertTime()">ğŸ”„ è½¬æ¢</button>
                <div id="messageArea"></div>
            </div>

            <div class="right-panel">
                <h2 class="results-title">è½¬æ¢ç»“æœ</h2>
                <div id="resultsContainer">
                    <div style="text-align: center; color: #666; padding: 50px 20px;">
                        <p>è¯·å…ˆé€‰æ‹©å›½å®¶å¹¶è¾“å…¥æ—¶é—´è¿›è¡Œè½¬æ¢</p>
                        <p style="margin-top: 20px; font-size: 4em;">â±ï¸</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>æ”¯æŒå¤ä»¤æ—¶è‡ªåŠ¨è®¡ç®— | ä¸­å›½æ ‡å‡†æ—¶é—´ (UTC+8)</p>
        </div>
    </div>

    <script>
        // å›½å®¶æ—¶åŒºä¿¡æ¯
        const countries = {
            us: {
                name: "ç¾å›½",
                flag: "ğŸ‡ºğŸ‡¸",
                timezone: -8, // PST (å†¬ä»¤æ—¶)
                timezoneName: "å¤ªå¹³æ´‹æ—¶é—´"
            },
            canada: {
                name: "åŠ æ‹¿å¤§",
                flag: "ğŸ‡¨ğŸ‡¦",
                timezone: -8, // PST (å†¬ä»¤æ—¶)
                timezoneName: "å¤ªå¹³æ´‹æ—¶é—´"
            },
            uk: {
                name: "è‹±å›½",
                flag: "ğŸ‡¬ğŸ‡§",
                timezone: 0, // GMT
                timezoneName: "æ ¼æ—å¨æ²»æ—¶é—´"
            },
            germany: {
                name: "å¾·å›½",
                flag: "ğŸ‡©ğŸ‡ª",
                timezone: 1, // CET (å†¬ä»¤æ—¶)
                timezoneName: "ä¸­æ¬§æ—¶é—´"
            }
        };

        // å¤ä»¤æ—¶åˆ¤æ–­å‡½æ•°
        function isDaylightSaving(date, countryKey) {
            const year = date.getFullYear();
            const month = date.getMonth();
            const day = date.getDate();
            
            if (countryKey === 'us' || countryKey === 'canada') {
                // ç¾å›½/åŠ æ‹¿å¤§å¤ä»¤æ—¶ï¼š3æœˆç¬¬äºŒä¸ªå‘¨æ—¥åˆ°11æœˆç¬¬ä¸€ä¸ªå‘¨æ—¥
                if (month > 2 && month < 10) return true;
                if (month === 2) {
                    const secondSunday = getNthDayOfMonth(year, 1, 0, 3);
                    return day >= secondSunday;
                }
                if (month === 10) {
                    const firstSunday = getNthDayOfMonth(year, 0, 0, 10);
                    return day <= firstSunday;
                }
            } else if (countryKey === 'germany') {
                // å¾·å›½å¤ä»¤æ—¶ï¼š3æœˆæœ€åä¸€ä¸ªå‘¨æ—¥åˆ°10æœˆæœ€åä¸€ä¸ªå‘¨æ—¥
                if (month > 2 && month < 9) return true;
                if (month === 2) {
                    const lastSunday = getLastDayOfMonth(year, 2, 0);
                    return day >= lastSunday;
                }
                if (month === 9) {
                    const lastSunday = getLastDayOfMonth(year, 9, 0);
                    return day <= lastSunday;
                }
            }
            return false;
        }

        // è·å–æŸæœˆç¬¬Nä¸ªæ˜ŸæœŸå‡ 
        function getNthDayOfMonth(year, n, dayOfWeek, month) {
            const firstDay = new Date(year, month, 1).getDay();
            const daysToAdd = (dayOfWeek - firstDay + 7) % 7;
            return 1 + daysToAdd + (n * 7);
        }

        // è·å–æŸæœˆæœ€åä¸€ä¸ªæ˜ŸæœŸå‡ 
        function getLastDayOfMonth(year, month, dayOfWeek) {
            const lastDay = new Date(year, month + 1, 0);
            const lastDayOfWeek = lastDay.getDay();
            const daysToSubtract = (lastDayOfWeek - dayOfWeek + 7) % 7;
            return lastDay.getDate() - daysToSubtract;
        }

        // è§£ææ—¶é—´å­—ç¬¦ä¸²
        function parseTimeString(timeStr) {
            // æ”¯æŒæ ¼å¼: xxxx/xx/xx xx:xx:xx
            const regex = /^(\d{4})\/(\d{2})\/(\d{2})\s+(\d{2}):(\d{2}):(\d{2})$/;
            const match = timeStr.match(regex);
            
            if (!match) {
                throw new Error('æ—¶é—´æ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨æ ¼å¼: xxxx/xx/xx xx:xx:xx');
            }
            
            const [, year, month, day, hour, minute, second] = match.map(Number);
            
            // éªŒè¯æ—¥æœŸæœ‰æ•ˆæ€§
            const date = new Date(year, month - 1, day, hour, minute, second);
            if (date.getFullYear() !== year || 
                date.getMonth() !== month - 1 || 
                date.getDate() !== day ||
                date.getHours() !== hour ||
                date.getMinutes() !== minute ||
                date.getSeconds() !== second) {
                throw new Error('è¾“å…¥çš„æ—¥æœŸæˆ–æ—¶é—´æ— æ•ˆ');
            }
            
            return date;
        }

        // è½¬æ¢æ—¶é—´åˆ°ä¸­å›½æ—¶é—´
        function convertToChinaTime(inputDate, countryKey) {
            const country = countries[countryKey];
            const baseOffset = country.timezone;
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºå¤ä»¤æ—¶
            const isDST = isDaylightSaving(inputDate, countryKey);
            const actualOffset = baseOffset + (isDST ? 1 : 0); // å¤ä»¤æ—¶åŠ 1å°æ—¶
            
            // è½¬æ¢ä¸ºUTCæ—¶é—´
            const utcTime = new Date(inputDate.getTime() - (actualOffset * 60 * 60 * 1000));
            
            // è½¬æ¢ä¸ºä¸­å›½æ—¶é—´ (UTC+8)
            const chinaTime = new Date(utcTime.getTime() + (8 * 60 * 60 * 1000));
            
            return {
                input: inputDate,
                china: chinaTime,
                isDST: isDST,
                offset: actualOffset,
                country: country
            };
        }

        // æ ¼å¼åŒ–æ˜¾ç¤ºæ—¶é—´
        function formatDateTime(date) {
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            }).replace(/\//g, '/').replace(',', '');
        }

        // è·å–æ—¶å·®æè¿°
        function getTimeDifferenceDescription(offset) {
            const diff = 8 - offset; // ä¸­å›½æ—¶é—´(UTC+8) - è¾“å…¥æ—¶é—´
            if (diff > 0) {
                return `+${diff}å°æ—¶`;
            } else if (diff < 0) {
                return `${diff}å°æ—¶`;
            } else {
                return '0å°æ—¶';
            }
        }

        // è½¬æ¢æ—¶é—´å‡½æ•°
        function convertTime() {
            const messageArea = document.getElementById('messageArea');
            const resultsContainer = document.getElementById('resultsContainer');
            
            try {
                // è·å–é€‰æ‹©çš„å›½å®¶
                const countrySelect = document.getElementById('countrySelect');
                const selectedCountry = countrySelect.value;
                
                if (!selectedCountry) {
                    throw new Error('è¯·é€‰æ‹©ä¸€ä¸ªå›½å®¶');
                }
                
                // è·å–è¾“å…¥çš„æ—¶é—´
                const timeInput = document.getElementById('timeInput');
                const timeStr = timeInput.value.trim();
                
                if (!timeStr) {
                    throw new Error('è¯·è¾“å…¥æ—¶é—´');
                }
                
                // è§£æè¾“å…¥çš„æ—¶é—´
                const inputDate = parseTimeString(timeStr);
                
                // è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´
                const result = convertToChinaTime(inputDate, selectedCountry);
                const country = result.country;
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                messageArea.innerHTML = '<div class="success-message">âœ… è½¬æ¢æˆåŠŸï¼</div>';
                
                // æ˜¾ç¤ºç»“æœ
                const chinaOffset = result.isDST ? result.offset + 1 : result.offset;
                const timeDiff = getTimeDifferenceDescription(result.offset);
                
                resultsContainer.innerHTML = `
                    <div class="result-card ${selectedCountry}">
                        <h3>${country.flag} ${country.name} â†’ ä¸­å›½</h3>
                        <div>${country.name}æ—¶é—´: <div class="input-time">${formatDateTime(result.input)}</div></div>
                        <div>ä¸­å›½æ—¶é—´: <div class="china-time">${formatDateTime(result.china)}</div></div>
                        <div class="time-difference">
                            æ—¶å·®: ${timeDiff} 
                            ${result.isDST ? '(å¤ä»¤æ—¶)' : '(æ ‡å‡†æ—¶é—´)'}
                        </div>
                    </div>
                `;
                
            } catch (error) {
                messageArea.innerHTML = `<div class="error-message">âŒ ${error.message}</div>`;
                resultsContainer.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 50px 20px;">
                        <p>è½¬æ¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼</p>
                        <p style="margin-top: 20px; font-size: 4em;">âš ï¸</p>
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®é»˜è®¤æ—¶é—´ä¸ºå½“å‰æ—¶é—´
            const now = new Date();
            const defaultTime = formatDateTime(now).replace(' ', ' ');
            document.getElementById('timeInput').value = defaultTime;
            
            // æ·»åŠ å›è½¦é”®æ”¯æŒ
            document.getElementById('timeInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    convertTime();
                }
            });
        });
    </script>
</body>
</html>
